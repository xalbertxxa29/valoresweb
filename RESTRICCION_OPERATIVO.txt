RESTRICCIÓN DE EDICIÓN EN OPERATIVO.JS
=====================================

CAMBIO APLICADO: Diciembre 1, 2025

Se ha confirmado y reforzado la restricción de edición en operativo.js:

✅ OPERATIVO NO PUEDE EDITAR SERVICIOS (items)

CAMBIOS REALIZADOS
==================

1. Removido botón "Editar Servicios" (⚙️)
   - Tabla de Solicitudes Pendientes
   - Tabla de Clientes en Ejecución

2. Removido event listener para openServicesEditor()
   - Ya no responde a clics en edit-services-btn
   - Previene cualquier intento de editar

3. Quitados los onclick handlers para los botones "Añadir"
   - Los botones de "Añadir Vigilancia"
   - Los botones de "Añadir Tecnología"


COMPORTAMIENTO AHORA
====================

OPERATIVO - Solo lectura:
  ✓ Puede VER detalles de clientes
  ✓ Puede VER servicios
  ✓ Puede GESTIONAR ejecución (marcar como en proceso/ejecutado)
  ✗ NO puede editar servicios
  ✗ NO puede agregar servicios
  ✗ NO puede modificar servicios

COMERCIAL - Lectura y edición:
  ✓ Puede VER detalles
  ✓ Puede EDITAR servicios (⚙️)
  ✓ Puede AGREGAR servicios
  ✓ Puede MODIFICAR servicios

DASHBOARD - Lectura y edición:
  ✓ Puede VER detalles
  ✓ Puede EDITAR servicios (⚙️)
  ✓ Puede AGREGAR servicios
  ✓ Puede MODIFICAR servicios


ARCHIVOS MODIFICADOS
====================

✏️  operativo.js

   Cambios específicos:
   - Línea ~407: Removido button de editar servicios
   - Línea ~423: Removido edit-services-btn del event listener
   - Línea ~481: Removido button de editar servicios (tabla ejecución)
   - Línea ~500: Removido edit-services-btn del event listener (tabla ejecución)


POR QUÉ ESTA RESTRICCIÓN
========================

El rol de OPERATIVO es:
  • Verificar que los servicios se están ejecutando correctamente
  • Marcar servicios como "En proceso" o "Ejecutados"
  • Ver detalles de cliente y servicios

El rol de COMERCIAL es:
  • Administrar servicios cuando se negocia con el cliente
  • Agregar o modificar servicios
  • Ajustar precios y cantidades

OPERATIVO no debe tener acceso de escritura a la configuración de servicios
porque eso podría alterar lo que ya fue negociado y aprobado por COMERCIAL.


VERIFICACIÓN
============

Para verificar que funciona correctamente:

1. Abre: http://localhost:5700/operativo.html
2. Ve a cualquier sección (Solicitudes Pendientes, Ejecución)
3. Busca un cliente
4. Deberías VER:
   ✓ Botón "Gestionar" (para marcar ejecución)
   ✓ Link "Ver Detalles" (para ver servicios)
5. NO deberías VER:
   ✗ Icono de engranaje (⚙️) para editar servicios
   ✗ Botón de "Editar Servicios"

Si ves el icono de engranaje, es porque hay caché. Limpia caché (Ctrl+Shift+Del)
y recarga la página (Ctrl+F5).


ROLLBACK (si es necesario)
==========================

Si necesitas permitir edición nuevamente:

1. En operativo.js, línea ~407:
   Agregar:
   <i class="fas fa-cogs action-icon edit-services-btn" 
      data-path="${docPath}" title="Editar Servicios"></i>

2. En operativo.js, línea ~423:
   Cambiar:
   tbody.querySelectorAll('.exec-pending-btn, .view-details-link').forEach(...)
   A:
   tbody.querySelectorAll('.exec-pending-btn, .view-details-link, .edit-services-btn').forEach(...)
   
   Y agregar:
   else if (target.classList.contains('edit-services-btn')) openServicesEditor(path);

3. Lo mismo para la tabla de ejecución (línea ~481 y ~500)


NOTAS IMPORTANTES
=================

• La función openServicesEditor() sigue existiendo en el código
  Esto es para evitar errores si se llama accidentalmente

• La función saveServicesChanges() también sigue existiendo
  Está protegida por validaciones y permisos de Firestore

• Si OPERATIVO intenta guardar cambios, Firestore lo bloqueará
  Por las reglas de seguridad (ver FIRESTORE_RULES.txt)


CONCLUSIÓN
==========

OPERATIVO ahora es 100% lectura + gestión de ejecución.
No tiene forma de editar, agregar o modificar servicios.

Esto protege la integridad de los datos y la lógica de negocio.
